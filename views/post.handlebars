<article>
    <h2>{{title}}</h2>
    <p>{{content}}</p>
    <p>Posted by {{user.username}} on {{createdAt}}</p>
    {{#if logged_in}}
        <form id="comment-form">
            <textarea name="content" placeholder="Leave a comment"></textarea>
            <button type="submit">Submit</button>
        </form>
    {{/if}}
    <section id="comments">
        {{#each comments}}
            <div class="comment">
                <p>{{this.content}}</p>
                <p>Commented by {{this.user.username}} on {{this.createdAt}}</p>
            </div>
        {{/each}}
    </section>
</article>

<script>
document.getElementById('comment-form').addEventListener('submit', async (event) => {
    event.preventDefault();
    const content = event.target.content.value.trim();
    const post_id = {{id}};

    if (content) {
        const response = await fetch('/api/comments', {
            method: 'POST',
            body: JSON.stringify({ content, post_id }),
            headers: { 'Content-Type': 'application/json' },
        });

        if (response.ok) {
            document.location.reload();
        } else {
            alert('Failed to add comment.');
        }
    }
});
</script>
